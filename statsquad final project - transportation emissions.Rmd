---
title: "statsquad final project - transportation emissions"
author: "Ali Sanford"
date: "April 23, 2017"
output: html_document
---

```{r setup, include=FALSE}
library(DataComputing)
library(dplyr)
library(geosphere) #contains the distance function that we used
library(ggplot2)
library(statisticalModeling)
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
emissionsdata <- read.table("/Users/alisanford/Desktop/statsfinalproject/zipemissions.txt", fill = TRUE) #imported data obtained from UC Berkeley's CoolClimate Network. Data includes info about carbon emissions for each zip code in the US, and some identifying information about each zip code.

colnames(emissionsdata) = as.character(unlist(emissionsdata[1,])) #made the first row of the emissionsdata df into the column names
emissionsdata = emissionsdata[-1,] #deleted the first row (containing column names)
emissionsdata$closestops <- rep(0,nrow(emissionsdata)) #added a new column; later we will check which bus stops are within ~3mi of each zip code and put the total in this column
```

```{r}
emissionsdataLA <- emissionsdata %>% #made a Los Angeles-specific df of emissions data
  filter(CountyName == "LOSANGELES") %>% #pulled out info only for zipcodes within Los Angeles County
  select(`ZipCode`, `Population`, `HouseholdsPerZipCode`, `PersonsPerHousehold`, `AverageHouseValue`, `IncomePerHousehold`, `Latitude`, `Longitude`, `CountyName`, `popden`, `electricity(kWh)`, `Nat.Gas(cu.ft.)`, `FUELOIL(gallons)`, `Vehiclemilestraveled`, `Transport(tCO2e/yr)`, `closestops`) %>% #selected only variables that might be relevant to our analysis
  mutate(Latitude = as.numeric(paste(Latitude)), Longitude = as.numeric(paste(Longitude))) #changed coordinates to numeric so that they will run through our distance function properly later



emissionsdataSF <- emissionsdata %>%
  filter(CountyName == "SANFRANCISCO") %>%
  select(`ZipCode`, `Population`, `HouseholdsPerZipCode`, `PersonsPerHousehold`, `AverageHouseValue`, `IncomePerHousehold`, `Latitude`, `Longitude`, `CountyName`, `popden`, `electricity(kWh)`, `Nat.Gas(cu.ft.)`, `FUELOIL(gallons)`, `Vehiclemilestraveled`, `Transport(tCO2e/yr)`, `closestops`) %>%
  mutate(Latitude = as.numeric(paste(Latitude)), Longitude = as.numeric(paste(Longitude))) #same process as above, but for San Francisco County rather than LA 

```


```{r}
metrobus <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/metrobusstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
metrobus_coords <- metrobus %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon)) 

metrorail <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/metrorailstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
metrorail_coords <- metrorail %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon)) 

bigbluebus <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/bigbluebusstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
bigbluebus_coords <- bigbluebus %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon)) 

burbankbus <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/burbankbusstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
burbankbus_coords <- burbankbus %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

culvercitybus <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/culvercitystops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
culvercitybus_coords <- culvercitybus %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

dash <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/DASHstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
dash_coords <- dash %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

foothilltransit <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/foothilltransitstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
foothilltransit_coords <- foothilltransit %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

gardenatransit <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/gardenatransitstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
gardenatransit_coords <- gardenatransit %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

longbeachtransit <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/longbeachstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
longbeachtransit_coords <- longbeachtransit %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

beachbus <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/redondobeachstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
beachbus_coords <- beachbus %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

torrancetransit <- read.table("/Users/alisanford/Desktop/statsfinalproject/lastops/torrancestops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
torrancetransit_coords <- torrancetransit %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))
```


```{r}
allLAstop_coords <- rbind(metrobus_coords, metrorail_coords, bigbluebus_coords, burbankbus_coords, culvercitybus_coords, dash_coords, foothilltransit_coords, gardenatransit_coords, longbeachtransit_coords, beachbus_coords, torrancetransit_coords)

allLAstop_coords_unique <- unique(allLAstop_coords)

allLAstop_coords1 <- allLAstop_coords_unique[complete.cases(allLAstop_coords_unique), ]
```


```{r}
for (i in 1:nrow(emissionsdataLA)) {
  d = 0
  a <- emissionsdataLA$Longitude[i] 
  b <- emissionsdataLA$Latitude[i] 
  dist <- c()
  
    for (j in 1:nrow(allLAstop_coords1)) {
      e <- allLAstop_coords1$stop_lon[j]
      f <- allLAstop_coords1$stop_lat[j]
      dist[j] = distHaversine(c(a, b),
                              c(e, f))
      
      if (dist[j] < 4828) {
        d = d + 1
      }
      emissionsdataLA$closestops[i] = d
    }
}
```

```{r}
bartstops <- read.csv("/Users/alisanford/Desktop/statsfinalproject/sfstops/BARTclean.csv")
bartstop_coords <- bartstops %>%
  filter(Zipcode %in% emissionsdataSF$ZipCode) %>%
  select(`Name`, `Latitude`, `Longitude`) %>%
  mutate(Latitude = as.numeric(Latitude), Longitude = as.numeric(Longitude))

munistops <- read.table("/Users/alisanford/Desktop/statsfinalproject/sfstops/munistops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
muni_coords <- munistops %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

samtransstops <- read.table("/Users/alisanford/Desktop/statsfinalproject/sfstops/samtransstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
samtrans_coords <- samtransstops %>%
  filter(zone_id == 2) %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

actransitstops <- read.table("/Users/alisanford/Desktop/statsfinalproject/sfstops/actransitstops.txt", fill=TRUE, header=TRUE, quote="", sep=",")
actransit_coords <- actransitstops %>%
  filter(stop_code %in% c("50582", "50591")) %>%
  select(`stop_name`, `stop_lat`, `stop_lon`) %>% 
  mutate(stop_lat = as.numeric(stop_lat), stop_lon = as.numeric(stop_lon))

```

```{r}
allSFstop_coords <- rbind(muni_coords, samtrans_coords, actransit_coords)
allSFstop_coords_unique <- unique(allSFstop_coords)
allSFstop_coords1 <- allSFstop_coords_unique[complete.cases(allSFstop_coords_unique), ]

```


```{r}
for (k in 1:nrow(emissionsdataSF)) {
  z = 0
  v <- emissionsdataSF$Longitude[k]
  w <- emissionsdataSF$Latitude[k]
  dista <- c()
  
    for (l in 1:nrow(allSFstop_coords1)) {
      x <- allSFstop_coords1$stop_lon[l]
      y <- allSFstop_coords1$stop_lat[l]
      dista[l] = distHaversine(c(v, w),
                              c(x, y))
      
      if (dista[l] < 4828) {
        z = z + 1
      }
      emissionsdataSF$closestops[k] = z
    }
}

```


```{r}
LAplot <- emissionsdataLA %>%
  ggplot(aes(x = closestops, y = `Transport(tCO2e/yr)`)) +
  geom_point()
```


```{r}
SFplot <- emissionsdataSF %>%
  ggplot(aes(x = closestops, y = `Transport(tCO2e/yr)`)) +
  geom_point()

```


```{r}
emissionsdataLAscores <- emissionsdataLA %>%
  mutate(Population = as.numeric(paste(Population))) %>%
  mutate(stopscore = closestops/Population)
```

```{r}
emissionsdataLA1 <- emissionsdataLA1 %>%
  mutate(`Transport(tCO2e/yr)` = as.numeric(paste(`Transport(tCO2e/yr)`)))
LA1kmplot <- emissionsdataLA1 %>%
  ggplot(aes(x = within1km, y = `Transport(tCO2e/yr)`)) +
  geom_point()
LA1kmplot

```


